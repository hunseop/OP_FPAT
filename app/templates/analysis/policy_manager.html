{% extends "base.html" %}

{% block extra_css %}
<link rel="stylesheet" href="{{ url_for('static', filename='css/policy_manager.css') }}">
{% endblock %}

{% block content %}
<div class="policy-manager">
    <div class="page-header">
        <h1>정책 관리자</h1>
        <p>정책 파일을 분석하고 관리하는 워크플로우입니다. 각 단계를 순서대로 진행하세요.</p>
    </div>

    <div class="workflow-container">
        <!-- 1단계: 초기화 -->
        <div class="step-card" data-step="initialized">
            <div class="step-header">
                <h3>1. 초기화</h3>
                <span class="step-status pending">대기중</span>
            </div>
            <div class="step-content">
                <p>정책 파일을 선택하고 방화벽 벤더를 지정하세요.</p>
                <form id="initForm" class="step-form">
                    <div class="form-group">
                        <label for="policy_file">정책 파일</label>
                        <input type="file" id="policy_file" name="policy_file" accept=".xlsx,.xls,.csv">
                    </div>
                    <div class="form-group">
                        <label for="vendor">방화벽 벤더</label>
                        <select id="vendor" name="vendor">
                            <option value="">선택하세요</option>
                            <option value="cisco">Cisco</option>
                            <option value="fortinet">Fortinet</option>
                            <option value="paloalto">Palo Alto</option>
                            <option value="juniper">Juniper</option>
                        </select>
                    </div>
                    <button type="submit" class="btn btn-primary">초기화</button>
                </form>
            </div>
        </div>

        <!-- 2단계: 신청 정보 처리 (선택사항) -->
        <div class="step-card" data-step="request_processed">
            <div class="step-header">
                <h3>2. 신청 정보 처리</h3>
                <span class="step-status pending">대기중</span>
            </div>
            <div class="step-content">
                <p>신청 정보 파일이 있는 경우 업로드하세요. (선택사항)</p>
                <form id="requestForm" class="step-form">
                    <div class="form-group">
                        <label for="request_file">신청 정보 파일</label>
                        <input type="file" id="request_file" name="request_file" accept=".xlsx,.xls,.csv">
                    </div>
                    <button type="submit" class="btn btn-primary" disabled>처리</button>
                </form>
            </div>
        </div>

        <!-- 3단계: 사용 데이터 처리 (선택사항) -->
        <div class="step-card" data-step="usage_processed">
            <div class="step-header">
                <h3>3. 사용 데이터 처리</h3>
                <span class="step-status pending">대기중</span>
            </div>
            <div class="step-content">
                <p>사용 이력 파일이 있는 경우 업로드하세요. (선택사항)</p>
                <form id="usageForm" class="step-form">
                    <div class="form-group">
                        <label for="usage_file">사용 이력 파일</label>
                        <input type="file" id="usage_file" name="usage_file" accept=".xlsx,.xls,.csv">
                    </div>
                    <button type="submit" class="btn btn-primary" disabled>처리</button>
                </form>
            </div>
        </div>

        <!-- 4단계: 벤더별 처리 -->
        <div class="step-card" data-step="vendor_processed">
            <div class="step-header">
                <h3>4. 벤더별 처리</h3>
                <span class="step-status pending">대기중</span>
            </div>
            <div class="step-content">
                <p>선택한 벤더에 맞게 정책을 처리합니다.</p>
                <button id="vendorProcessBtn" class="btn btn-primary" disabled>처리 시작</button>
            </div>
        </div>

        <!-- 5단계: 중복 정책 분석 -->
        <div class="step-card" data-step="duplicates_analyzed">
            <div class="step-header">
                <h3>5. 중복 정책 분석</h3>
                <span class="step-status pending">대기중</span>
            </div>
            <div class="step-content">
                <p>정책 간의 중복을 분석합니다.</p>
                <button id="duplicateAnalysisBtn" class="btn btn-primary" disabled>분석 시작</button>
            </div>
        </div>

        <!-- 6단계: 보고서 생성 -->
        <div class="step-card" data-step="reports_generated">
            <div class="step-header">
                <h3>6. 보고서 생성</h3>
                <span class="step-status pending">대기중</span>
            </div>
            <div class="step-content">
                <p>분석 결과를 바탕으로 보고서를 생성합니다.</p>
                <button id="generateReportsBtn" class="btn btn-primary" disabled>보고서 생성</button>
            </div>
        </div>
    </div>

    <div class="results-section">
        <h2>워크플로우 결과</h2>
        
        <div class="no-results">
            <p>아직 결과가 없습니다. 워크플로우를 시작하세요.</p>
        </div>
        
        <div class="results-files" style="display: none;">
            <div class="intermediate-files">
                <h3>중간 결과 파일</h3>
                <ul id="intermediateFiles" class="file-list"></ul>
            </div>
            
            <div class="report-files">
                <h3>보고서</h3>
                <ul id="reportFiles" class="file-list"></ul>
            </div>
            
            <div class="download-all">
                <button id="downloadAllBtn" class="btn btn-primary" disabled>모든 파일 다운로드</button>
            </div>
        </div>
    </div>

    <!-- 워크플로우 상태 모달 -->
    <div id="workflowModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>처리 중...</h3>
                <button class="close-btn">&times;</button>
            </div>
            <div class="modal-body">
                <div class="progress-bar">
                    <div class="progress-fill"></div>
                    <span class="progress-text">0%</span>
                </div>
                <p class="status-message">작업을 처리하고 있습니다...</p>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block extra_js %}
<script src="{{ url_for('static', filename='js/policy_manager.js') }}"></script>
{% endblock %} 